{% extends "base.html" %}
{% block title %}Edit Coupon{% endblock %}

{% block content %}
<div class="container py-4">

  <h4 class="fw-bold mb-3">Edit Coupon – {{ coupon.code }}</h4>

  <div class="card shadow-sm">
    <div class="card-body">

      <form method="POST">

        <!-- Code (locked) -->
        <div class="mb-3">
          <label class="form-label">Coupon Code</label>
          <input type="text" class="form-control" value="{{ coupon.code }}" disabled>
        </div>

        <!-- Type -->
        <div class="mb-3">
          <label class="form-label">Discount Type</label>
          <select class="form-select" name="coupon_type">
            <option value="percent" {% if coupon.coupon_type=='percent' %}selected{% endif %}>Percentage (%)</option>
            <option value="fixed" {% if coupon.coupon_type=='fixed' %}selected{% endif %}>Fixed Amount (₦)</option>
          </select>
        </div>

        <!-- Amount -->
        <div class="mb-3">
          <label class="form-label">Discount Amount</label>
          <input type="number" step="0.01" class="form-control" name="amount"
                 value="{{ coupon.amount }}">
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Starts At</label>
            <input type="datetime-local" class="form-control" name="starts_at"
                   value="{{ coupon.starts_at.strftime('%Y-%m-%dT%H:%M') if coupon.starts_at }}">
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">Expires At</label>
            <input type="datetime-local" class="form-control" name="expires_at"
                   value="{{ coupon.expires_at.strftime('%Y-%m-%dT%H:%M') if coupon.expires_at }}">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Minimum Subtotal (Optional)</label>
          <input type="number" step="0.01" class="form-control" 
                 name="min_subtotal" value="{{ coupon.min_subtotal or '' }}">
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Max Uses (Optional)</label>
            <input type="number" class="form-control" 
                   name="max_uses" value="{{ coupon.max_uses or '' }}">
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label">Max Uses Per User (Optional)</label>
            <input type="number" class="form-control" 
                   name="max_uses_per_user" value="{{ coupon.max_uses_per_user or '' }}">
          </div>
        </div>

        <!-- Restrict to delivery zones -->
        <div class="mb-3">
          <label class="form-label">Restrict to Delivery Zones (Optional)</label>
          <select class="form-select" name="zones" multiple size="6">
            {% for z in zones %}
              <option value="{{ z.id }}"
                {% if z.id in selected_zones %}selected{% endif %}
              >{{ z.name }}</option>
            {% endfor %}
          </select>
          <small class="text-muted">Hold CTRL (Windows) or CMD (Mac) to select multiple zones.</small>
        </div>

        <!-- Note -->
        <div class="mb-3">
          <label class="form-label">Admin Note</label>
          <textarea class="form-control" name="note" rows="2">{{ coupon.note }}</textarea>
        </div>

        <hr>

        <button class="btn btn-primary">Save Changes</button>
        <a href="{{ url_for('admin.coupons_list') }}" class="btn btn-secondary">Cancel</a>

      </form>

    </div>
  </div>

</div>
{% endblock %}
