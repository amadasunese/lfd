<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"/>
<div id="adminZoneMap" style="height:500px;"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
<script>
const map = L.map('adminZoneMap').setView([6.338, 5.625], 12); // Benin City center coords - tweak as necessary
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(map);

const drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

const drawControl = new L.Control.Draw({
    edit: { featureGroup: drawnItems },
    draw: { polygon: true, polyline: false, rectangle: false, circle: false, marker: false }
});
map.addControl(drawControl);

map.on(L.Draw.Event.CREATED, function (e) {
    const layer = e.layer;
    drawnItems.addLayer(layer);
    const geojson = layer.toGeoJSON().geometry;
    // show UI/modal to choose name and delivery_area (select)
    const title = prompt('Zone title (e.g. GRA Zone):');
    if(!title) { drawnItems.removeLayer(layer); return; }
    const deliveryAreaId = prompt('Delivery area ID (or leave blank):');
    fetch("{{ url_for('admin_delivery.create_zone') }}", {
        method: 'POST',
        headers: {'Content-Type':'application/json','X-CSRFToken': '{{ csrf_token() }}'},
        body: JSON.stringify({ title: title, polygon: geojson, delivery_area_id: deliveryAreaId })
    }).then(r=>r.json()).then(data=>{
        if(data.success) alert('Saved zone');
    }).catch(err=>{ alert('Failed to save zone'); console.error(err) });
});
</script>
